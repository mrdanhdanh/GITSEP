<!DOCTYPE html>
<html lang="">
<head>
  <meta charset="UTF-8">
  <title></title>
    <link href="css/ext-theme-neptune-all-debug.css" type="text/css" rel="stylesheet">
    <link href="css/writer.css" type="text/css" rel="stylesheet">
    <link href='http://fonts.googleapis.com/css?family=Roboto&subset=latin,vietnamese' rel='stylesheet' type='text/css'>
    <script type="text/javascript" src="javascript/ext-all.js"></script>
    <script src="javascript/jquery-2.1.1.min.js"></script>
    <script src="javascript/jquery.ba-resize.min.js"></script>
    <script src="javascript/highcharts/highcharts.js"></script>
    <script src="javascript/highcharts/no-data-to-display.js"></script>
    <script src="javascript/highcharts/exporting.js"></script>
    <script src="javascript/ext.js"></script> <!-- Script chính cho viewport và các thành phần khác --> 
    <script>
             
//Phần code cho chart và các hiệu ứng
//Tạo options cho chart

options = {
    chart: {
        type: 'spline',
        zoomType: 'x',
        style: {fontFamily: 'Roboto'},
        selectionMarkerFill: 'rgba(151, 224, 135, 0.25)',
        resetZoomButton: {
                position: {
                    // align: 'right', // by default
                    // verticalAlign: 'top', // by default
                    x: -10,
                    y: 80
                },
                relativeTo: 'chart',
                theme: {
                    fill: 'white',
                    stroke: 'silver',
                    r: 5,
                    states: {
                        hover: {
                            fill: '#00a512',
                            style: {
                                color: 'white'
                            }
                        }
                    }
                }
        }
    },
    
    credits: {
        enabled: true,
        href: 'ext.html',
        text: 'SEP'
    },
    title: {
        text: 'Nồng độ theo thời gian'
    },
    subtitle: {
        text: 'Ngày tháng năm'
    },
    xAxis: {
        type: 'datetime',
        dateTimeLabelFormats: {
	millisecond: '%H:%M:%S.%L',
	second: '%H:%M:%S',
	minute: '%H:%M',
	hour: '%H:%M',
	day: '%e. %b',
	week: '%e. %b',
	month: '%b \'%y',
	year: '%Y'
},
        title: {
            text: 'Thời gian'
        }
    },
    yAxis: {
        title: {
            text: 'Nồng độ'
        },
        plotLines: [{
            value: 0,
            color: 'red',
            width: 2,
            zIndex: 4,
            label: {
                text: 'Qui chuẩn Việt Nam: Không quy định',
                align: 'left',
                style: {
                    color: 'red'
                }
            }  
        }]
    },
    
    tooltip: {
        enabled: true,
        hideDelay: 100,
        formatter: function() {
            return 'Thời gian: ' + Highcharts.dateFormat('%H:%M', this.x)+'<br/>'+
                'Nồng độ: '+ this.y;
        }
    },
    legend: {
        enabled: false
    },
    exporting: {
        enabled: true
    },
    plotOptions: {                         
        series: {
            allowPointSelect: true,
            marker: {
                enabled: true,
                states: {
                    select: {
                        fillColor: '#25e57b',
                        lineColor: '#25e57b',
                        lineWidth: '3px'
                    }
                }
            },
            point: {
                events: {
                    click: function(){
                        var grid = Ext.getCmp('mygrid');
                        var store=Ext.getStore('store');
                        var rowid=getId(this.x);
                        var page=store.getPageFromRecordIndex(rowid);
                        var row=rowid-((page-1)*itemsPerPage);
                        store.loadPage(page);
                        grid.getView().focusRow(row);
                    }
                }
                
            },
            cursor: 'pointer',
            turboThreshold: 100
        },

    },
    series: [{}],
    lang: {
        noData: "Không có số liệu theo yêu cầu"
    },
    noData: {
        style: {
            fontWeight: 'bold',
            fontSize: '20px',
            color: '#303030'
        }
    }
};
</script>
    <script>
        // Các function khác
    unit=['ppm','ppm','ppb','ppb','ppb','ppb','ppm','ppb','microg/Nm3'];
    function showdata(subs){
        options.series[0].data=[];
        var result=Ext.getStore('store').proxy.data;
        var date=Ext.getCmp('date').getSubmitValue();
        options.yAxis.title.text= 'Nồng độ ('+unit[subs-1]+')';
        options.title.text='Nồng độ '+Ext.getCmp('subs').getStore().data.items[subs-1].data.name+' theo thời gian';
        options.subtitle.text='Ngày '+date.substr(8,2)+' tháng '+date.substr(5,2)+' năm '+date.substr(0,4);
        if (subs==4||subs==6||subs==7||subs==8||subs==9) {
            options.yAxis.plotLines[0].value=100;
            options.yAxis.plotLines[0].label.text='Qui chuẩn Việt Nam: 100';
        }
        else {
            options.yAxis.plotLines[0].value=0;
            options.yAxis.plotLines[0].label.text='Qui chuẩn Việt Nam: Không qui định';
        }
        if (result.length!=0){
        for (var i=0;i<result.length;i++) {
            var jyea=result[i][0].substr(0,4);
            var jmon=result[i][0].substr(5,2)-1;
            var jday=result[i][0].substr(8,2);
            var jhou=result[i][1].substr(0,2);
            var jmin=result[i][1].substr(3,2);
            var jsec=result[i][1].substr(6,2);
            options.series[0].data.push([Date.UTC(jyea,jmon,jday,jhou,jmin,jsec),result[i][subs+1]]);
        }        
        drawchartaqi();
        } else $('#chart-innerCt').highcharts(options);
    }
    function drawchartaqi(){
        $('#chart-innerCt').highcharts(options);
        var chart=$('#chart-innerCt').highcharts();
        var text = chart.renderer.text(
                'AQI = ', 
                chart.plotLeft + 10, 
                chart.plotTop + 50
            ).attr({
                zIndex: 5
            }).css({
                color: '#000',
                fontSize: '16px'
            }).add();
        
        var box = text.getBBox();
        chart.renderer.rect(box.x - 5, box.y - 5, box.width + 10, box.height + 10, 0)
            .attr({
                fill: 'rgb(0, 177, 255)',
                stroke: 'rgba(0, 140, 255, 0.76)',
                'stroke-width': 1,
                zIndex: 4
            })
            .add();
        
    }
    function getId(value){  
        var ar=options.series[0].data;
        for (var i=0;i<ar.length;i++){
            if (ar[i][0]==value || ar[i].x==value) break;
        }
        return i;
    }
        window.onload = function(){ setTimeout(
            function(){
                $('#chart-innerCt').highcharts(options);
                $('#chart-innerCt').resize(function(){
                    $('#chart-innerCt').highcharts().reflow();
                });
            }
            , 100); };
        $(document).ready(function(){
  $(document).ajaxError(function(e,xhr,opt){
    Ext.Msg.alert('Error', xhr.status+' - '+xhr.statusText);
        });});
        
                                
    </script>
</head>

<body>
</body>
</html>